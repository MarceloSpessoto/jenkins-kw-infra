services:
  jenkins:
    build: 
      context: jenkins
      args: 
        - DOCKER_AGENT_PORT=${DOCKER_AGENT_PORT}
        - VM_AGENT_PORT=${VM_AGENT_PORT}
    environment:
      - JAVA_OPTS=-Djenkins.install.runSetupWizard=false
      - CASC_JENKINS_CONFIG=/usr/local/configuration/jcac.yml
      - SSH_DOCKER_PASSWORD=${SSH_DOCKER_PASSWORD}
      - SSH_VM_PASSWORD=${SSH_VM_PASSWORD}
    network_mode: "host"
  docker-agent:
    build: 
      context: docker-agent
      args:
        - DOCKER_AGENT_PORT=${DOCKER_AGENT_PORT}
    environment:
      - JAVA_OPTS=-Djenkins.install.runSetupWizard=false
      - JENKINS_AGENT_SSH_PUBKEY=${JENKINS_AGENT_SSH_PUBKEY}
    network_mode: "host"
